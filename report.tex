\documentclass[10pt,a4paper]{article}

\usepackage[margin=0.5in]{geometry}
\usepackage{booktabs}
\usepackage{enumitem}
\usepackage{titlesec}
\usepackage{xcolor}
\usepackage{tcolorbox}
\usepackage{multicol}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{tabularx}
\usepackage{array}

\definecolor{boxgray}{RGB}{248,249,250}
\definecolor{accent}{RGB}{25,55,109}
\definecolor{success}{RGB}{40,167,69}
\definecolor{muted}{RGB}{108,117,125}

\titleformat{\section}{\normalsize\bfseries\color{accent}}{}{0pt}{}
\titlespacing*{\section}{0pt}{5pt}{2pt}

\setlength{\parskip}{0pt}
\setlength{\parindent}{0pt}

\tcbset{
  colback=boxgray,
  colframe=accent,
  boxsep=1pt,
  left=3pt,
  right=3pt,
  top=2pt,
  bottom=2pt,
  arc=2pt
}

\begin{document}

% ============ HEADER ============
\begin{center}
    {\LARGE\bfseries\color{accent} ML-Driven Trading System for Sonata Software}\\[3pt]
    \textbf{KSHITIJ 2026} · FinStreet Hackathon · IIT Kharagpur\\[2pt]
    {\color{muted}\small Aman Behera · IIT Roorkee · Team RobinHoodHashing}
\end{center}

\vspace{2pt}
\hrule height 0.5pt
\vspace{4pt}

% ============ KEY METRICS BOX ============
\begin{tcolorbox}[colframe=success, colback=white, boxsep=3pt]
\begin{center}
\begin{tabular}{ccccc}
\textbf{Win Rate} & \textbf{Sharpe Ratio} & \textbf{Total Return} & \textbf{Max Drawdown} & \textbf{Profit Factor} \\
\Large\textbf{88.9\%} & \Large\textbf{6.62} & \Large\textbf{1.31\%} & \Large\textbf{0.05\%} & \Large\textbf{29.27} \\
\end{tabular}
\end{center}
\end{tcolorbox}

\vspace{-4pt}

% ============ TWO COLUMN LAYOUT ============
\begin{multicols}{2}

% ------ WHAT ------
\section{What We Built}

\begin{tcolorbox}
\small
\textbf{Trend-following system} that:
\begin{itemize}[leftmargin=10pt, itemsep=-1pt, topsep=1pt]
    \item Trades \textbf{only} in trend direction
    \item Enters on \textbf{pullbacks}, not reversals
    \item Uses ML as a \textbf{filter}, not predictor
    \item Prioritizes \textbf{capital preservation}
\end{itemize}
\end{tcolorbox}

% ------ HOW ------
\section{How It Works}

\begin{tcolorbox}
\footnotesize
\begin{tabular}{@{}ll@{}}
\textbf{Step} & \textbf{Action} \\
\midrule
1. Trend ID & EMA(10)/SMA(20) + ADX \\
2. Entry & Wait for 6\% pullback \\
3. Validate & ML confirms direction \\
4. Size & Scale by confidence \\
5. Manage & ATR-based stops \\
\end{tabular}
\end{tcolorbox}

% ------ WHY ------
\section{Why This Approach}

\begin{tcolorbox}
\small
\begin{itemize}[leftmargin=10pt, itemsep=-1pt, topsep=1pt]
    \item Sonata showed \textbf{continuation patterns}
    \item Mean-reversion \textbf{failed} in backtest
    \item Pullbacks = \textbf{low-risk entries}
    \item ML filters \textbf{bad setups}
\end{itemize}
\end{tcolorbox}

% ------ ML COMPONENT ------
\section{ML Component}

\begin{tcolorbox}
\footnotesize
\textbf{Ensemble:} XGBoost (60\%) + LightGBM (40\%)

\vspace{1pt}
\begin{tabular}{@{}ll@{}}
\textbf{Input} & RSI, MACD, ADX features \\
\textbf{Output} & P(Up) vs P(Down) \\
\textbf{Role} & Reject Tech $\neq$ ML trades \\
\textbf{Training} & Walk-forward, no leakage \\
\end{tabular}
\end{tcolorbox}

% ------ RISK MANAGEMENT ------
\section{Risk Management}

\begin{tcolorbox}
\footnotesize
\begin{tabular}{@{}ll@{}}
\textbf{Control} & \textbf{Rule} \\
\midrule
Position Size & $\text{risk} = \text{base} \times (0.5 + \text{conf})$ \\
Max Risk & 5\% per trade \\
Stop Loss & 1.5$\times$ ATR \\
Take Profit & 3$\times$ ATR \\
Trailing & 2.5$\times$ ATR \\
Regime Filter & ADX $<$ 15 $\rightarrow$ no trade \\
\end{tabular}
\end{tcolorbox}

\columnbreak

% ------ OPTIMIZATION ------
\section{Parameter Optimization}

\begin{tcolorbox}
\footnotesize
\textbf{Method:} Randomized search (150 configs)

\vspace{1pt}
\begin{tabular}{@{}lcc@{}}
\textbf{Param} & \textbf{Range} & \textbf{Best} \\
\midrule
Pullback & 6--12\% & \textbf{6\%} \\
Risk/Trade & 2--5\% & \textbf{3--5\%} \\
Stop ATR & 1.2--1.8$\times$ & \textbf{1.5$\times$} \\
Target ATR & 3--6$\times$ & \textbf{3$\times$} \\
ADX Min & 12--18 & \textbf{15} \\
Trailing & 1.5--2.5$\times$ & \textbf{2.5$\times$} \\
\end{tabular}

\vspace{1pt}
\textbf{Objective:} Max(Return $\times$ Sharpe) $-$ DD penalty
\end{tcolorbox}

% ------ BACKTEST ------
\section{Backtest Results}

\begin{tcolorbox}
\footnotesize
\begin{tabular}{@{}ll|ll@{}}
\textbf{Metric} & \textbf{Value} & \textbf{Metric} & \textbf{Value} \\
\midrule
Period & Nov--Dec 2025 & Trades & 9 \\
Symbol & SONATSOFTW & Winners & 8 \\
Capital & ₹100,000 & Win Rate & 88.9\% \\
Final & ₹101,314 & Sharpe & 6.62 \\
Return & 1.31\% & Max DD & 0.05\% \\
\end{tabular}
\end{tcolorbox}

% ------ PREDICTIONS ------
\section{Forward Predictions (Jan 1-8, 2026)}

\begin{tcolorbox}
\footnotesize
\textit{XGBoost output on Dec 31, 2025 state:}

\vspace{1pt}
\begin{tabular}{@{}lccc@{}}
\textbf{Date} & \textbf{Signal} & \textbf{Conf} & \textbf{Regime} \\
\midrule
Jan 1 & HOLD & 69\% & Uptrend \\
Jan 2 & HOLD & 69\% & Uptrend \\
Jan 5 & HOLD & 69\% & Uptrend \\
Jan 6 & HOLD & 69\% & Uptrend \\
Jan 7 & HOLD & 69\% & Uptrend \\
Jan 8 & HOLD & 69\% & Uptrend \\
\end{tabular}

\vspace{1pt}
\textit{HOLD = ML direction conflicts with technical regime}
\end{tcolorbox}

% ------ COMPLIANCE ------
\section{Data Integrity \& Compliance}

\begin{tcolorbox}
\footnotesize
\begin{tabular}{@{}ll@{}}
\textbf{Check} & \textbf{Status} \\
\midrule
No future data in features & \textcolor{success}{\textbf{✓}} \\
Labels from T+2 to T+5 returns & \textcolor{success}{\textbf{✓}} \\
Walk-forward validation & \textcolor{success}{\textbf{✓}} \\
FYERS API only (data + exec) & \textcolor{success}{\textbf{✓}} \\
Audit script passed & \textcolor{success}{\textbf{✓}} \\
\end{tabular}
\end{tcolorbox}

\end{multicols}

\vspace{-2pt}
\hrule height 0.5pt
\vspace{3pt}

% ============ ARCHITECTURE DIAGRAM ============
\begin{center}
\footnotesize
\texttt{FYERS API} $\rightarrow$ \texttt{Features (RSI, MACD, ADX)} $\rightarrow$ \texttt{XGBoost+LightGBM} $\rightarrow$ \texttt{Signal Gate} $\rightarrow$ \texttt{Risk Mgmt} $\rightarrow$ \texttt{Execute}
\end{center}

\vspace{1pt}

% ============ FOOTER ============
\begin{tcolorbox}[colback=white, colframe=muted, boxsep=2pt]
\begin{center}
\footnotesize
\textbf{Key Insight:} High win rate (88.9\%) + tight stops (1.5× ATR) + minimal drawdown (0.05\%) = \textbf{sustainable edge}\\
System compounds small, consistent gains while protecting capital — built for real-world deployment.
\end{center}
\end{tcolorbox}
\newpage

\begin{center}
    {\Large\bfseries\color{accent} Methodology and Execution Details}
\end{center}

\vspace{4pt}
\hrule height 0.5pt
\vspace{6pt}

% ================= DATA + LOGIC =================
\begin{tcolorbox}
\small
All market data is sourced exclusively from the \textbf{FYERS API} using daily OHLCV candles.
Data from \textbf{Jan–Oct 2025} is used only for indicator warmup
(e.g., moving averages, momentum) and is never used for model training
or trade decisions.

Model training and backtesting are restricted to the permitted window
from \textbf{November 1 to December 31, 2025}.
Forward signals for \textbf{January 1–8, 2026} are generated as a true out-of-sample forecast.

The strategy is rule-based and structure-driven.
Trend direction is identified using the EMA(10)–SMA(20) relationship and its slope,
with entries taken only on controlled pullbacks within an established trend
to improve risk–reward.
\end{tcolorbox}

\vspace{6pt}

% ================= EQUITY + DRAWDOWN =================
\begin{figure}[h!]
    \centering
    \includegraphics[width=0.75\linewidth]{equity_drawdown_dual.png}
    \caption{\small Equity curve and drawdown during the Nov–Dec 2025 backtest period}
\end{figure}

\vspace{4pt}

% ================= EXECUTION + BIAS =================
\begin{tcolorbox}
\small
Machine learning is used only as a validation layer.
It estimates directional confidence from recent trend, momentum, volatility,
and volume features, and does not predict prices or returns.
Trades are taken only when ML and technical signals align;
otherwise, they are skipped.

Backtesting follows a strict chronological walk-forward process.
Signals are generated after market close and executed at the next session open.
Exits are evaluated using intraday high and low prices,
with positions closed at end-of-day if neither stop-loss nor target is reached.

A dedicated audit process verifies the absence of look-ahead bias.
Features use only past data, rolling indicators respect their lookback windows,
and labels are derived from forward returns by design.
\end{tcolorbox}


\vspace{6pt}

% ================= PRICE + DISTRIBUTION =================
\begin{figure}[h!]
\centering
\begin{minipage}{0.48\linewidth}
    \centering
    \includegraphics[width=\linewidth]{price_with_trades.png}
    \caption{\small Price action with executed trades}
\end{minipage}
\hfill
\begin{minipage}{0.48\linewidth}
    \centering
    \includegraphics[width=\linewidth]{trade_distribution.png}
    \caption{\small Distribution of trade outcomes}
\end{minipage}
\end{figure}

\vspace{4pt}
\hrule height 0.5pt
\vspace{4pt}

\begin{center}
\footnotesize
\textbf{Summary:}
A rule-based trend-following system enhanced by probabilistic validation,
evaluated under strict data constraints with realistic execution
and no look-ahead bias.
\end{center}


\end{document}
